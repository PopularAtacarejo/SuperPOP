<!DOCTYPE html>
<html lang="pt-BR"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>SuperPop | Login</title>
<link href="https://i.ibb.co/99R7YqxF/Icon.png" rel="icon" type="image/png"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#E63946",
            secondary: "#FFB703",
            "surface-light": "#F8F9FA"
          },
          fontFamily: {
            display: ["Fredoka One", "cursive"],
            body: ["Nunito", "sans-serif"]
          },
          boxShadow: {
            card: "0 15px 40px -10px rgba(0, 0, 0, 0.12)"
          }
        }
      }
    };
  </script>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&amp;family=Nunito:wght@400;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<style>
    .bg-pattern {
      background-color: #ffffff;
      background-image: radial-gradient(#E63946 0.5px, transparent 0.5px), radial-gradient(#FFB703 0.5px, #ffffff 0.5px);
      background-size: 20px 20px;
      background-position: 0 0, 10px 10px;
      opacity: 0.4;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      pointer-events: none;
    }
  </style>
</head>
<body class="min-h-screen font-body bg-white text-gray-900">
<div class="bg-pattern"></div>
<main class="min-h-screen flex items-center justify-center px-5 py-8">
<section class="w-full max-w-md bg-white/95 border border-white/60 rounded-2xl shadow-card p-6 sm:p-8">
<div class="text-center mb-6">
<img alt="SuperPop" class="mx-auto w-40 h-auto mb-3" src="https://i.ibb.co/VpLWwfNB/Gemini-Generated-Image-1aiacj1aiacj1aia.png"/>
<h1 class="font-display text-3xl text-primary uppercase tracking-tight">Login</h1>
<p class="text-sm text-gray-600 font-semibold mt-2">Acesse com seu telefone e senha.</p>
</div>
<form class="space-y-4" id="loginForm" novalidate>
<div>
<label class="block text-xs font-bold text-primary uppercase mb-1.5 ml-1" for="numeroCelular">Telefone</label>
<input class="w-full px-4 py-3.5 bg-surface-light border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all font-semibold placeholder-gray-400 text-gray-800 shadow-sm" id="numeroCelular" inputmode="numeric" maxlength="18" placeholder="(82) 9 0000 - 0000" required type="text"/>
</div>
<div>
<label class="block text-xs font-bold text-primary uppercase mb-1.5 ml-1" for="senha">Senha</label>
<div class="relative">
<input class="w-full pl-4 pr-12 py-3.5 bg-surface-light border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all font-semibold placeholder-gray-400 text-gray-800 shadow-sm" id="senha" required type="password"/>
<button aria-label="Mostrar senha" class="absolute right-3 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-8 h-8 rounded-lg text-gray-500 hover:text-primary hover:bg-red-50 transition-colors" id="toggleSenha" type="button">
<span class="material-symbols-outlined text-[20px]" id="toggleSenhaIcon">visibility</span>
</button>
</div>
</div>
<label class="flex items-center gap-2 text-sm font-semibold text-gray-600 select-none cursor-pointer">
<input class="rounded border-gray-300 text-primary focus:ring-primary" id="manterConectado" type="checkbox"/>
<span>Manter conectado por 24h</span>
</label>
<div class="rounded-xl bg-red-50 border border-red-100 px-4 py-3 text-sm font-semibold text-red-700 hidden" id="statusErro"></div>
<div class="rounded-xl bg-green-50 border border-green-100 px-4 py-3 text-sm font-semibold text-green-700 hidden" id="statusSucesso"></div>
<button class="w-full inline-flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-primary text-white font-bold tracking-wide shadow-md hover:bg-red-700 transition-colors disabled:opacity-70 disabled:cursor-not-allowed" id="submitBtn" type="submit">
<span class="material-symbols-outlined text-base">login</span>
<span id="submitBtnLabel">Entrar</span>
</button>
<p class="text-xs text-center text-gray-500">Sem cadastro? <a class="text-primary font-bold hover:underline" href="cadastro.html">Cadastre-se</a></p>
</form>
</section>
</main>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("loginForm");
    const phoneInput = document.getElementById("numeroCelular");
    const passwordInput = document.getElementById("senha");
    const rememberInput = document.getElementById("manterConectado");
    const toggleSenhaBtn = document.getElementById("toggleSenha");
    const toggleSenhaIcon = document.getElementById("toggleSenhaIcon");
    const statusErro = document.getElementById("statusErro");
    const statusSucesso = document.getElementById("statusSucesso");
    const submitBtn = document.getElementById("submitBtn");
    const submitBtnLabel = document.getElementById("submitBtnLabel");
    const PHONE_REGEX = /^\(\d{2}\)\s9\s\d{4}\s-\s\d{4}$/;
    const apiBase = String(window.SUPERPOP_API_URL || "https://superpopbackend.onrender.com").replace(/\/+$/, "");

    if (rememberInput) {
      rememberInput.checked = true;
    }

    function formatPhoneMask(value) {
      const digits = String(value || "").replace(/\D/g, "").slice(0, 11);
      if (!digits) return "";
      if (digits.length <= 2) return "(" + digits;
      if (digits.length <= 3) return "(" + digits.slice(0, 2) + ") " + digits.slice(2);
      if (digits.length <= 7) return "(" + digits.slice(0, 2) + ") " + digits.slice(2, 3) + " " + digits.slice(3);
      return "(" + digits.slice(0, 2) + ") " + digits.slice(2, 3) + " " + digits.slice(3, 7) + " - " + digits.slice(7, 11);
    }

    function setLoading(isLoading) {
      submitBtn.disabled = isLoading;
      submitBtnLabel.textContent = isLoading ? "Entrando..." : "Entrar";
    }

    function showError(message) {
      statusSucesso.classList.add("hidden");
      statusErro.textContent = message;
      statusErro.classList.remove("hidden");
    }

    function showSuccess(message) {
      statusErro.classList.add("hidden");
      statusSucesso.textContent = message;
      statusSucesso.classList.remove("hidden");
    }

    const query = new URLSearchParams(window.location.search);

    if (query.get("registered") === "1") {
      showSuccess("Cadastro finalizado com sucesso. FaÃ§a login para continuar.");
    }

    phoneInput.addEventListener("input", function () {
      const cursorAtEnd = phoneInput.selectionStart === phoneInput.value.length;
      phoneInput.value = formatPhoneMask(phoneInput.value);
      if (cursorAtEnd) {
        phoneInput.setSelectionRange(phoneInput.value.length, phoneInput.value.length);
      }
    });

    if (toggleSenhaBtn && passwordInput && toggleSenhaIcon) {
      toggleSenhaBtn.addEventListener("click", function () {
        const isPassword = passwordInput.type === "password";
        passwordInput.type = isPassword ? "text" : "password";
        toggleSenhaIcon.textContent = isPassword ? "visibility_off" : "visibility";
        toggleSenhaBtn.setAttribute("aria-label", isPassword ? "Ocultar senha" : "Mostrar senha");
      });
    }

    form.addEventListener("submit", async function (event) {
      event.preventDefault();
      statusErro.classList.add("hidden");
      statusSucesso.classList.add("hidden");

      const numeroCelular = String(phoneInput.value || "").trim();
      const senha = String(passwordInput.value || "");
      const manterConectado = Boolean(rememberInput && rememberInput.checked);
      if (!PHONE_REGEX.test(numeroCelular)) {
        showError("Numero de celular invalido. Use o formato (xx) 9 0000 - 0000.");
        return;
      }
      if (!senha) {
        showError("Informe a senha.");
        return;
      }

      setLoading(true);
      try {
        const response = await fetch(apiBase + "/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ numero_celular: numeroCelular, senha: senha, manter_conectado: manterConectado })
        });
        const result = await response.json().catch(function () { return {}; });
        if (!response.ok || !result.ok) {
          throw new Error(String(result.error || "Falha ao fazer login."));
        }

        try {
          localStorage.setItem("superpop_auth_user", JSON.stringify(result.funcionario || {}));
        } catch (_err) {}

        showSuccess("Login realizado com sucesso. Redirecionando...");
        window.setTimeout(function () {
          window.location.href = "superpop.html";
        }, 700);
      } catch (err) {
        showError(String(err && err.message ? err.message : "Erro inesperado ao fazer login."));
      } finally {
        setLoading(false);
      }
    });
  });
</script>
</body></html>
